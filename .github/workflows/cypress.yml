name: Cypress
on:
  repository_dispatch:
    types: [deployment-ready]
jobs:
  tests:
    runs-on: ubuntu-latest
    concurrency: deploy-${{ github.head_ref }}
    steps:
      - name: Checkout
        uses: actions/checkout@v1

      - name: debug
        run: echo ${{ toJSON(github.event) }}

      - name: Run Cypress
        uses: cypress-io/github-action@v2
        id: cypress
        with:
          working-directory: ./restaurant-reviewer
          record: true
        env:
          CYPRESS_BASE_URL: ${{ github.event.client-payload.preview-url }}
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
